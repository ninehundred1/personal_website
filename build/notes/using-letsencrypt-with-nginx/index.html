<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Welcome | Nathan Hefner</title>
    <meta name="description" content="">

    <link rel="stylesheet" href="/static/css/main.css">
    <link rel="stylesheet" href="/static/components/ionicons/css/ionicons.css">

    <script src="https://use.typekit.net/fti0giy.js"></script>
    <script>try{Typekit.load({ async: true });}catch(e){}</script>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
    <script src="/static/js/prettify.js"></script>
    <script src="/static/js/app.js"></script>
  </head>
  <body onload="prettyPrint()">
    
    <header class="site-header">
      <div class="wrapper">
        <a class="site-title" href="/">Nathan Hefner</a>
        <nav class="site-nav">
          <div class="trigger">
            <a class="page-link" href="/about/">About</a>
            <a class="page-link" href="/notes/">Notes</a>
            <a class="page-link" href="/work/">Work</a>
          </div>
        </nav>
      </div>
    </header>
    

    
<section class="hero-unit" style="background-image: url(/static/img/posts/4.jpg);">
  <div class="overlay"></div>
  <div class="inner">
    <h1>Using Let&#39;s Encrypt with Nginx</h1>
    <p class="post-meta">Posted: December 10, 2015</p>
  </div>
</section>


    <section class="content">
      <div class="wrapper">
        
<div class="post">

  <div class="post-content">
    <p><a href="https://letsencrypt.org/">Let's Encrypt</a> is a new certificate authority from the <a href="https://letsencrypt.org/isrg/">Internet Security Research Group</a> that provides free, automated SSL certificates. It is backed by some big name sponsors, including Mozilla, Facebook, Cisco, and more. In addition to being the easiest way to get and install an SSL certificate, Let's Encrypt has also <a href="https://github.com/letsencrypt/letsencrypt">open sourced</a> their client. While the client works seamlessly for the automatic setup of certificates on Apache, their is still some manual intervention required to set up the certificates for nginx. I will walk you that process in this guide.</p>
<p>Once you SSH into your server, you will need to download the Let's Encrypt client. Make sure Git is installed. If it is not, run the following command:</p>
<pre><code class="bash">sudo apt-get install git
</code></pre>

<p>Next, clone the client:</p>
<pre><code class="bash">git clone https://github.com/letsencrypt/letsencrypt
</code></pre>

<p>Then, cd into the cloned directory:</p>
<pre><code class="bash">cd letsencrypt
</code></pre>

<p>We will have to temporarily stop nginx in order to validate the domain for the certificate. Run the following command to do so:</p>
<pre><code class="bash">sudo service nginx stop
</code></pre>

<p>This is where the magic happens. The following command tells Let's Encrypt that we want to get the certificate only, authenticating through a standalone webserver, for the domain "yourdomain.com". To specify multiple domains, list the domains space-separated after the "-d" tag. Make sure to replace "youremailhere@mail.com" with a valid email, as this is where important messages regarding the certificates will go.</p>
<pre><code class="bash">./letsencrypt-auto certonly --standalone --email youremailhere@mail.com -d yourdomain.com --agree-tos
</code></pre>

<p>If the command runs successfully, the SSL certificates will have been issued.It is now safe to start nginx if you wish:</p>
<pre><code class="bash">sudo service nginx start
</code></pre>

<p>The SSL certificate directories will need to have their permissions updated. Run the following commands to do so, replacing "yourdomain.com" with your actual domain:</p>
<pre><code class="bash">sudo chmod -R 775 /etc/letsencrypt/live/yourdomain.com
sudo chmod -R 775 /etc/letsencrypt/archive/yourdomain.com
</code></pre>

<p>Now the nginx config will need to be updated. Below is a barebones configuration. For a more in depth and secure configuration, I recommend the <a href="https://mozilla.github.io/server-side-tls/ssl-config-generator/">Mozilla SSL Configuration Generator</a> as a good starting point.</p>
<pre><code>server {
    listen              443 ssl;
    server_name         yourdomain.com;
    ssl_certificate     /etc/letsencrypt/live/yourdomain.com/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/yourdomain.com/privkey.pem;
}
</code></pre>

<p>In order to forward HTTP traffic to HTTPS, add the following lines to the top of the config:</p>
<pre><code>server {
   listen       80;
   server_name  yourdomain.com;
   return       301 https://$server_name$request_uri;
}
</code></pre>

<p>Check to make sure the nginx config has no errors and restart nginx:</p>
<pre><code>sudo nginx -t
sudo service nginx restart
</code></pre>

<p>Your site should now be available over HTTPS! It is important to note that the certificates only have a 90 day lifetime. To renew the certificates, simply rerun the commands. Let's Encrypt is working diligently to fully automate the renewal process, and their are some third party solutions popping up as well. For more of the technical details of the process, check out this <a href="https://letsencrypt.org/howitworks/technology/">link</a>. Happy coding!</p>
  </div>

</div>

      </div>
    </section>

    
    <footer class="site-footer">
      <div class="wrapper">
        <ul class="social-links">
          <li><a href="https://github.com/natehefner"><i class="icon ion-social-octocat"></i></a></li>
          <li><a href="https://instagram.com/natehefner_"><i class="icon ion-social-instagram"></i></a></li>
          <li><a href="https://twitter.com/natehefner"><i class="icon ion-social-twitter"></i></a></li>
          <li><a href="https://linkedin.com/in/nathanhefner"><i class="icon ion-social-linkedin"></i></a></li>
        </ul>
        <div class="email">
          <a href="mailto:hefner.nathan@gmail.com">Email Me</a>
        </div>
      </div>
    </footer>
    

    
    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-41594454-1', 'auto');
    ga('send', 'pageview');
    </script>
    
  </body>
</html>